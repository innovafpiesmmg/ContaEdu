Guía Maestra de Construcción: Simulador Contable Educativo (CFGM/CFGS)Este documento detalla la hoja de ruta completa para construir una aplicación de contabilidad profesional diseñada para el entorno educativo, utilizando Node.js, Express y PostgreSQL dentro de Replit.1. Arquitectura de Usuarios y Gestión EscolarEl sistema está diseñado para reflejar la estructura de un centro educativo, permitiendo la gestión de múltiples ciclos lectivos y una supervisión jerárquica:A. Administrador General (Root)Instalación: Se crea automáticamente con credenciales por defecto.Gestión de Ciclos: Crea, activa, desactiva o borra Años Escolares (ej. 2024-2025). Solo un año puede estar activo para edición.Gestión Fiscal: Decide globalmente si el sistema opera bajo el régimen de IVA (Península/Baleares) o IGIC (Canarias). Esto cambia dinámicamente las etiquetas y cuentas del sistema.Gestión de Profesores: Crea cuentas para los Administradores de Curso.B. Administrador de Curso (Profesor)Gestión de Grupos: Crea cursos específicos (ej. 1º CFGM Gestión Administrativa, 2º CFGS Administración y Finanzas).Repositorio de Ejercicios: Crea una biblioteca de casos prácticos (Guiados y de Práctica) que se pueden reutilizar y clonar entre cursos y años.Módulo de Exámenes: Programa evaluaciones con límites de tiempo y restricciones de interfaz.Auditoría: Acceso en tiempo real (modo solo lectura) al trabajo de cualquier alumno.C. Alumno (Estudiante)Perfil: Vinculado a un curso, profesor y año escolar activo.Entorno Contable: Registro de diario, visualización de mayor, generación de balances y realización de exámenes.2. Secuencia de Prompts para Replit Agent (UX/UI Premium)Introduce estos prompts uno por uno en el Replit Agent. No avances al siguiente hasta que la funcionalidad actual sea estable.Fase 1: Infraestructura, Años Escolares e Impuestos"Crea una aplicación profesional con Node.js, Express y PostgreSQL. Implementa autenticación segura con bcrypt y sesiones.Configuración Fiscal: El SUPER_ADMIN debe poder seleccionar entre régimen de 'IVA' o 'IGIC'. Esta variable debe ser global y cambiar las etiquetas de toda la app.Diseño Visual: Usa Tailwind CSS con una paleta profesional: Azul Marino (#1e3a8a) y Gris Pizarra (#475569). Interfaz tipo SaaS con barra lateral, bordes rounded-xl y sombras shadow-sm.Panel Root: Gestión de Años Escolares (con estados Activo/Archivado) y creación de Profesores."Fase 2: Gestión de Cursos y Dashboard del Profesor"Mejora el panel para 'COURSE_ADMIN'.Gestión de Grupos: Usa Cards visuales para mostrar cursos con su código de acceso.Dashboard de Clase: Tabla con indicadores de actividad de alumnos (última conexión, asientos totales).Estadísticas: Tarjetas superiores con iconos de Lucide-React para mostrar métricas rápidas del aula."Fase 3: Motor Contable y Diario Dinámico"Implementa el núcleo contable para Alumnos.Diario Inteligente: Formulario dinámico para asientos compuestos. Debe validar en tiempo real que SUM(Debe) === SUM(Haber), mostrando indicadores visuales verde/rojo.Plan de Cuentas: Carga los grupos 1-7 del PGC. Implementa un buscador con autocompletado por código o nombre.Lógica Fiscal: Adapta automáticamente las cuentas del grupo 47 según la elección (IVA o IGIC) del Admin General."Fase 4: Constructor de Ejercicios y Repositorio"Crea el 'Constructor de Ejercicios' para Profesores usando un componente de pasos (Stepper):Paso 1: Datos básicos (Título, descripción, dificultad).Paso 2: Selección de Tipo: 'Guiado' (con pistas por asiento) o 'Práctica' (libre).Paso 3: Repositorio Personal. Permite guardar estos ejercicios como plantillas, editarlos, clonarlos o asignarlos a diferentes cursos/años escolares."Fase 5: Libro Mayor (Cuentas T) y Auditoría"Desarrolla el Libro Mayor visual.Cuentas T: Diseño visual dividido con Debe (azul claro) y Haber (ámbar claro).Auditoría Docente: El profesor debe tener un botón 'Ver Trabajo' para entrar en la sesión del alumno en modo 'Solo Lectura', con un banner de aviso amarillo persistente en la parte superior."Fase 6: Reportes y Exportación PDF"Implementa los estados financieros:Balance de Sumas y Saldos: Reporte de 4 columnas.PyG y Balance de Situación: Estructura jerárquica con totales resaltados.Exportación: Generación de PDFs con cabecera profesional del centro educativo y sello de tiempo."Fase 7: Módulo de Exámenes y Evaluación"Implementa el sistema de evaluaciones:Configuración de Examen: El profesor asigna un ejercicio del repositorio como examen, definiendo:Alcance: 'Solo Diario' (bloquea balances) o 'Ciclo Completo'.Cronómetro: Tiempo límite en minutos y ventana de acceso.Modo Examen Alumno: Temporizador visible, bloqueo de pistas y deshabilitación de navegación externa.Libro de Notas: Panel para que el profesor califique y comente las entregas."3. Manual de Contabilidad Financiera (Didáctico)Sección para la pestaña de 'Ayuda' del programa.A. La Ecuación FundamentalToda la lógica del sistema descansa en el equilibrio:Activo = Pasivo + Patrimonio NetoB. Funcionamiento de las CuentasCuentas de Activo: Nacen y aumentan por el Debe (izquierda). Disminuyen por el Haber (derecha).Cuentas de Pasivo y Neto: Nacen y aumentan por el Haber. Disminuyen por el Debe.Gastos (6): Siempre se cargan (Debe), excepto en la regularización.Ingresos (7): Siempre se abonan (Haber), excepto en la regularización.C. El IVA y el IGICSoportado (Compras): Es un derecho frente a Hacienda (Activo). Se anota en el Debe.Repercutido (Ventas): Es una obligación frente a Hacienda (Pasivo). Se anota en el Haber.4. Identidad Visual y Branding (EcoBalance)Paleta de Colores:Primario: #1e3a8a (Azul Marino Profesional).Éxito: #10b981 (Verde Esmeralda para descuadres 0).Error: #ef4444 (Rojo para avisos de cuadre).Componentes: Uso de Cards para dashboards, Toasts para notificaciones y Modales para confirmaciones de borrado.5. Banco de Casos Prácticos de EjemploConstitución (Práctica): Se crea la empresa con 100.000€ en bancos y un local de 150.000€.Compra Mercaderías (Guiado): Compra de 2.000€ + Impuesto. Pago 50% banco, 50% deuda.Pista: Usa la cuenta (600) para la compra y la (472) para el impuesto soportado.Venta Servicios (Examen): Venta de asesoría por 500€ + Impuesto. Cobro por banco.6. Recomendaciones Técnicas FinalesTransacciones SQL: Imprescindibles en el Diario para evitar datos corruptos.Seguridad: Middleware para asegurar que los estudiantes no accedan a las APIs de otros estudiantes o profesores.Persistencia: Utilizar la base de datos PostgreSQL de Replit para garantizar que los datos sobrevivan a los reinicios del contenedor.